!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.rivets=e():t.rivets=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var r=i(1),s=n(r),a=i(4),o=n(a),u=i(2),h=i(7),c=n(h),l=i(8),f=n(l),d=i(6),p=n(d);s.default.binders=f.default,s.default.adapters["."]=c.default,s.default.bind=function(t,e,i){var n={};e=e||{},i=i||{},u.EXTENSIONS.forEach(function(t){n[t]=Object.create(null),i[t]&&Object.keys(i[t]).forEach(function(e){n[t][e]=i[t][e]}),Object.keys(s.default[t]).forEach(function(e){n[t][e]||(n[t][e]=s.default[t][e])})}),u.OPTIONS.forEach(function(t){var e=i[t];n[t]=null!=e?e:s.default[t]}),n.starBinders=Object.keys(n.binders).filter(function(t){return t.indexOf("*")>0}),p.default.updateOptions(n);var r=new o.default(t,e,n);return r.bind(),r},s.default.formatters.negate=s.default.formatters.not=function(t){return!t},t.exports=s.default},function(t,e,i){"use strict";e.__esModule=!0;var n=i(2),r=i(3),s={binders:{},formatters:{},adapters:{},_prefix:"rv",_fullPrefix:"rv-",get prefix(){return this._prefix},set prefix(t){this._prefix=t,this._fullPrefix=t+"-"},parseTemplate:r.parseTemplate,parseType:r.parseType,templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,i){this.call(t,e,i.view.models)},fallbackBinder:function(t,e){null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},configure:function(t){var e=this;t&&Object.keys(t).forEach(function(i){var r=t[i];n.EXTENSIONS.indexOf(i)>-1?Object.keys(r).forEach(function(t){e[i][t]=r[t]}):e[i]=r})}};e.default=s},function(t,e){"use strict";e.__esModule=!0;e.OPTIONS=["prefix","templateDelimiters","rootInterface","preloadData","handler"],e.EXTENSIONS=["binders","formatters","adapters"]},function(t,e){"use strict";function i(t){var e=r,i=t;return u.test(t)?i=t.slice(1,-1):"true"===t?i=!0:"false"===t?i=!1:"null"===t?i=null:"undefined"===t?i=void 0:isNaN(t)?e=s:i=Number(t),{type:e,value:i}}function n(t,e){for(var i,n=t.length,r=0,s=0,u=e[0],h=e[1];s<n;){if(r=t.indexOf(u,s),r<0){i&&i.push({type:a,value:t.slice(s)});break}if(i||(i=[]),r>0&&s<r&&i.push({type:a,value:t.slice(s,r)}),s=r+u.length,r=t.indexOf(h,s),r<0){var c=t.slice(s-h.length),l=i[i.length-1];l&&l.type===a?l.value+=c:i.push({type:a,value:c});break}var f=t.slice(s,r).trim();i.push({type:o,value:f}),s=r+h.length}return i}e.__esModule=!0,e.parseType=i,e.parseTemplate=n;var r=0,s=1,a=0,o=1,u=/^'.*'$|^".*"$/},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=i(1),a=n(s),o=i(5),u=i(3),h={routine:function(t,e){t.data=null!=e?e:""}},c=/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g,l=function t(e,i){var n=!1;if(3===i.nodeType){var r=(0,u.parseTemplate)(i.data,a.default.templateDelimiters);if(r){for(var s=0;s<r.length;s++){var o=r[s],c=document.createTextNode(o.value);i.parentNode.insertBefore(c,i),1===o.type&&e.buildBinding(c,null,o.value,h,null)}i.parentNode.removeChild(i)}n=!0}else 1===i.nodeType&&(n=e.traverse(i));if(!n)for(var l=0;l<i.childNodes.length;l++)t(e,i.childNodes[l])},f=function(t,e){var i=t.binder?t.binder.priority||0:0,n=e.binder?e.binder.priority||0:0;return n-i},d=function(t){return t.trim()},p=function(){function t(e,i,n){r(this,t),e.jquery||e instanceof Array?this.els=e:this.els=[e],this.models=i,this.options=n,this.build()}return t.prototype.buildBinding=function(t,e,i,n,r){var s=i.match(c).map(d),a=s.shift();this.bindings.push(new o.Binding(this,t,e,a,n,r,s))},t.prototype.build=function(){this.bindings=[];var t=this.els,e=void 0,i=void 0;for(e=0,i=t.length;e<i;e++)l(this,t[e]);this.bindings.sort(f)},t.prototype.traverse=function(t){for(var e,i,n,r,s=a.default._fullPrefix,o="SCRIPT"===t.nodeName||"STYLE"===t.nodeName,u=t.attributes,h=[],c=this.options.starBinders,l=0,f=u.length;l<f;l++){var d=u[l];if(0===d.name.indexOf(s)){if(e=d.name.slice(s.length),i=this.options.binders[e],r=void 0,!i)for(var p=0;p<c.length;p++)if(n=c[p],e.slice(0,n.length-1)===n.slice(0,-1)){i=this.options.binders[n],r=e.slice(n.length-1);break}if(i||(i=a.default.fallbackBinder),i.block)return this.buildBinding(t,e,d.value,i,r),t.removeAttribute(d.name),!0;h.push({attr:d,binder:i,type:e,arg:r})}}for(var v=0;v<h.length;v++){var b=h[v];this.buildBinding(t,b.type,b.attr.value,b.binder,b.arg),t.removeAttribute(b.attr.name)}return o},t.prototype.bind=function(){this.bindings.forEach(function(t){t.bind()})},t.prototype.unbind=function(){this.bindings.forEach(function(t){t.unbind()})},t.prototype.sync=function(){this.bindings.forEach(function(t){t.sync()})},t.prototype.publish=function(){this.bindings.forEach(function(t){t.binder&&t.binder.publishes&&t.publish()})},t.prototype.update=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).forEach(function(i){t.models[i]=e[i]}),this.bindings.forEach(function(t){t.update&&t.update(e)})},t}();e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){var e=[];return"checkbox"===t.type?t.checked:"select-multiple"===t.type?(t.options.forEach(function(t){t.selected&&e.push(t.value)}),e):t.value}e.__esModule=!0,e.Binding=void 0;var a=i(3),o=i(6),u=n(o),h=/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g,c=/\s+/;e.Binding=function(){function t(e,i,n,s,a,o,u){r(this,t),this.view=e,this.el=i,this.type=n,this.keypath=s,this.binder=a,this.arg=o,this.formatters=u,this.formatterObservers={},this.model=void 0}return t.prototype.observe=function(t,e){return new u.default(t,e,this)},t.prototype.parseTarget=function(){if(this.keypath){var t=(0,a.parseType)(this.keypath);0===t.type?this.value=t.value:(this.observer=this.observe(this.view.models,this.keypath),this.model=this.observer.target)}else this.value=void 0},t.prototype.parseFormatterArguments=function(t,e){var i=this;return t.map(a.parseType).map(function(t,n){var r=t.type,s=t.value;if(0===r)return s;i.formatterObservers[e]||(i.formatterObservers[e]={});var a=i.formatterObservers[e][n];return a||(a=i.observe(i.view.models,s),i.formatterObservers[e][n]=a),a.value()})},t.prototype.formattedValue=function(t){var e=this;return this.formatters.reduce(function(t,i,n){var r=i.match(h),s=r.shift(),a=e.view.options.formatters[s],o=e.parseFormatterArguments(r,n);return a&&a.read instanceof Function?t=a.read.apply(a,[t].concat(o)):a instanceof Function&&(t=a.apply(void 0,[t].concat(o))),t},t)},t.prototype.eventHandler=function(t){var e=this,i=e.view.options.handler;return function(n){i.call(t,this,n,e)}},t.prototype.set=function(t){t=t instanceof Function&&!this.binder.function?this.formattedValue(t.call(this.model)):this.formattedValue(t);var e=this.binder.routine||this.binder;e instanceof Function&&e.call(this,this.el,t)},t.prototype.sync=function(){this.observer?(this.model=this.observer.target,this.set(this.observer.value())):this.set(this.value)},t.prototype.publish=function(){var t=this;if(this.observer){var e=this.formatters.reduceRight(function(e,i,n){var r=i.split(c),s=r.shift(),a=t.view.options.formatters[s],o=t.parseFormatterArguments(r,n);return a&&a.publish&&(e=a.publish.apply(a,[e].concat(o))),e},this.getValue(this.el));this.observer.setValue(e)}},t.prototype.bind=function(){this.parseTarget(),this.binder.hasOwnProperty("bind")&&this.binder.bind.call(this,this.el),this.view.options.preloadData&&this.sync()},t.prototype.unbind=function(){var t=this;this.binder.unbind&&this.binder.unbind.call(this,this.el),this.observer&&this.observer.unobserve(),Object.keys(this.formatterObservers).forEach(function(e){var i=t.formatterObservers[e];Object.keys(i).forEach(function(t){i[t].unobserve()})}),this.formatterObservers={}},t.prototype.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.observer&&(this.model=this.observer.target),this.binder.update&&this.binder.update.call(this,t)},t.prototype.getValue=function(t){return this.binder&&this.binder.getValue?this.binder.getValue.call(this,t):s(t)},t}()},function(t,e){"use strict";function i(t){return"object"===("undefined"==typeof t?"undefined":u(t))&&null!==t}function n(t){throw new Error("[Observer] "+t)}function r(t,e,n){this.keypath=e,this.callback=n,this.objectPath=[],this.parse(),this.obj=this.getRootObject(t),i(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}e.__esModule=!0;var s,a,o,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r.updateOptions=function(t){s=t.adapters,a=Object.keys(s),o=t.rootInterface},r.tokenize=function(t,e){var i,n,r=[],s={i:e,path:""};for(i=0;i<t.length;i++)n=t.charAt(i),~a.indexOf(n)?(r.push(s),s={i:n,path:""}):s.path+=n;return r.push(s),r},r.prototype.parse=function(){var t,e;a.length||n("Must define at least one adapter interface."),~a.indexOf(this.keypath[0])?(e=this.keypath[0],t=this.keypath.substr(1)):(e=o,t=this.keypath),this.tokens=r.tokenize(t,e),this.key=this.tokens.pop()},r.prototype.realize=function(){for(var t,e,n=this.obj,r=-1,s=0;s<this.tokens.length;s++)e=this.tokens[s],i(n)?("undefined"!=typeof this.objectPath[s]?n!==(t=this.objectPath[s])&&(this.set(!1,e,t,this),this.set(!0,e,n,this),this.objectPath[s]=n):(this.set(!0,e,n,this),this.objectPath[s]=n),n=this.get(e,n)):(r===-1&&(r=s),(t=this.objectPath[s])&&this.set(!1,e,t,this));return r!==-1&&this.objectPath.splice(r),n},r.prototype.sync=function(){var t,e,n;(t=this.realize())!==this.target?(i(this.target)&&this.set(!1,this.key,this.target,this.callback),i(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,n=this.value(),(n!==e||n instanceof Function)&&this.callback.sync()):t instanceof Array&&this.callback.sync()},r.prototype.value=function(){if(i(this.target))return this.get(this.key,this.target)},r.prototype.setValue=function(t){i(this.target)&&s[this.key.i].set(this.target,this.key.path,t)},r.prototype.get=function(t,e){return s[t.i].get(e,t.path)},r.prototype.set=function(t,e,i,n){var r=t?"observe":"unobserve";s[e.i][r](i,e.path,n)},r.prototype.unobserve=function(){for(var t,e,n=0;n<this.tokens.length;n++)e=this.tokens[n],(t=this.objectPath[n])&&this.set(!1,e,t,this);i(this.target)&&this.set(!1,this.key,this.target,this.callback)},r.prototype.getRootObject=function(t){var e,i;if(!t.$parent)return t;for(e=this.tokens.length?this.tokens[0].path:this.key.path,i=t;i.$parent&&void 0===i[e];)i=i.$parent;return i},e.default=r},function(t,e){"use strict";e.__esModule=!0;var i=["push","pop","shift","unshift","sort","reverse","splice"],n={counter:0,weakmap:{},weakReference:function(t){if(!t.hasOwnProperty("__rv")){var e=this.counter++;Object.defineProperty(t,"__rv",{value:e})}return this.weakmap[t.__rv]||(this.weakmap[t.__rv]={callbacks:{}}),this.weakmap[t.__rv]},cleanupWeakReference:function(t,e){Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length||delete this.weakmap[e]},stubFunction:function(t,e){var i=t[e],n=this.weakReference(t),r=this.weakmap;t[e]=function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];var o=i.apply(t,s);return Object.keys(n.pointers).forEach(function(t){var e=n.pointers[t];r[t]&&r[t].callbacks[e]instanceof Array&&r[t].callbacks[e].forEach(function(t){t.sync()})}),o}},observeMutations:function(t,e,n){var r=this;if(t instanceof Array){var s=this.weakReference(t);s.pointers||(s.pointers={},i.forEach(function(e){r.stubFunction(t,e)})),s.pointers[e]||(s.pointers[e]=[]),s.pointers[e].indexOf(n)===-1&&s.pointers[e].push(n)}},unobserveMutations:function(t,e,i){if(t instanceof Array&&null!=t.__rv){var n=this.weakmap[t.__rv];if(n){var r=n.pointers[e];if(r){var s=r.indexOf(i);s>-1&&r.splice(s,1),r.length||delete n.pointers[e],this.cleanupWeakReference(n,t.__rv)}}}},observe:function(t,e,i){var n,r=this,s=this.weakReference(t).callbacks;if(!s[e]){s[e]=[];var a=Object.getOwnPropertyDescriptor(t,e);a&&(a.get||a.set||!a.configurable)||(n=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return n},set:function(i){if(i!==n){r.unobserveMutations(n,t.__rv,e),n=i;var s=r.weakmap[t.__rv];if(s){var a=s.callbacks[e];a&&a.forEach(function(t){t.sync()}),r.observeMutations(i,t.__rv,e)}}}}))}s[e].indexOf(i)===-1&&s[e].push(i),this.observeMutations(t[e],t.__rv,e)},unobserve:function(t,e,i){var n=this.weakmap[t.__rv];if(n){var r=n.callbacks[e];if(r){var s=r.indexOf(i);s>-1&&(r.splice(s,1),r.length||(delete n.callbacks[e],this.unobserveMutations(t[e],t.__rv,e))),this.cleanupWeakReference(n,t.__rv)}}},get:function(t,e){return t[e]},set:function(t,e,i){t[e]=i}};e.default=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i){var n=t.el.cloneNode(!0),r=new a.default(n,e,t.view.options);return r.bind(),t.marker.parentNode.insertBefore(n,i),r}e.__esModule=!0;var s=i(4),a=n(s),o=function(t){return null!=t?t.toString():void 0},u=function(t,e){for(var i=0;i<t;i++)e()},h={"on-*":{function:!0,priority:1e3,unbind:function(t){this.handler&&t.removeEventListener(this.arg,this.handler)},routine:function(t,e){this.handler&&t.removeEventListener(this.arg,this.handler),this.handler=this.eventHandler(e),t.addEventListener(this.arg,this.handler)}},"each-*":{block:!0,priority:4e3,bind:function(t){this.marker?this.iterated.forEach(function(t){t.bind()}):(this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t))},unbind:function(t){this.iterated&&this.iterated.forEach(function(t){t.unbind()})},routine:function(t,e){var i=this,n=this.arg;e=e||[];var s=t.getAttribute("index-property")||"$index";e.forEach(function(t,e){var a={$parent:i.view.models};a[s]=e,a[n]=t;var o=i.iterated[e];if(o)if(o.models[n]!==t){for(var u=void 0,h=void 0,c=e+1;c<i.iterated.length;c++)if(h=i.iterated[c],h.models[n]===t){u=c;break}void 0!==u?(i.iterated.splice(u,1),i.marker.parentNode.insertBefore(h.els[0],o.els[0]),h.models[s]=e):h=r(i,a,o.els[0]),i.iterated.splice(e,0,h)}else o.models[s]=e;else{var l=i.marker;i.iterated.length&&(l=i.iterated[i.iterated.length-1].els[0]),o=r(i,a,l.nextSibling),i.iterated.push(o)}}),this.iterated.length>e.length&&u(this.iterated.length-e.length,function(){var t=i.iterated.pop();t.unbind(),i.marker.parentNode.removeChild(t.els[0])}),"OPTION"===t.nodeName&&this.view.bindings.forEach(function(t){t.el===i.marker.parentNode&&"value"===t.type&&t.sync()})},update:function(t){var e=this,i={};Object.keys(t).forEach(function(n){n!==e.arg&&(i[n]=t[n])}),this.iterated.forEach(function(t){t.update(i)})}},"class-*":function(t,e){var i=" "+t.className+" ";!e==i.indexOf(" "+this.arg+" ")>-1&&(e?t.className=t.className+" "+this.arg:t.className=i.replace(" "+this.arg+" "," ").trim())},text:function(t,e){t.textContent=null!=e?e:""},html:function(t,e){t.innerHTML=null!=e?e:""},show:function(t,e){t.style.display=e?"":"none"},hide:function(t,e){t.style.display=e?"none":""},enabled:function(t,e){t.disabled=!e},disabled:function(t,e){t.disabled=!!e},checked:{publishes:!0,priority:2e3,bind:function(t){var e=this;this.callback||(this.callback=function(){e.publish()}),t.addEventListener("change",this.callback)},unbind:function(t){t.removeEventListener("change",this.callback)},routine:function(t,e){"radio"===t.type?t.checked=o(t.value)===o(e):t.checked=!!e}},value:{publishes:!0,priority:3e3,bind:function(t){if(this.isRadio="INPUT"===t.tagName&&"radio"===t.type,!this.isRadio){this.event=t.getAttribute("event-name")||("SELECT"===t.tagName?"change":"input");var e=this;this.callback||(this.callback=function(){e.publish()}),t.addEventListener(this.event,this.callback)}},unbind:function(t){this.isRadio||t.removeEventListener(this.event,this.callback)},routine:function(t,e){if(this.isRadio)t.setAttribute("value",e);else if("select-multiple"===t.type){if(e instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];n.selected=e.indexOf(n.value)>-1}}else o(e)!==o(t.value)&&(t.value=null!=e?e:"")}},if:{block:!0,priority:4e3,bind:function(t){this.marker?this.bound===!1&&this.nested&&this.nested.bind():(this.marker=document.createComment(" rivets: "+this.type+" "+this.keypath+" "),this.attached=!1,t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)),this.bound=!0},unbind:function(){this.nested&&(this.nested.unbind(),this.bound=!1)},routine:function(t,e){!!e!==this.attached&&(e?(this.nested||(this.nested=new a.default(t,this.view.models,this.view.options),this.nested.bind()),this.marker.parentNode.insertBefore(t,this.marker.nextSibling),this.attached=!0):(t.parentNode.removeChild(t),this.attached=!1))},update:function(t){this.nested&&this.nested.update(t)}}};e.default=h}])});